<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Keystom - Custom Car Keychains</title>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://js.stripe.com/v3/"></script>
<style>
  html { scroll-behavior: smooth; }
  body { scroll-padding-top: 70px; }
  #navbar { position: sticky; top: 0; z-index: 50; background: white; box-shadow: 0 2px 8px rgba(0,0,0,0.05); }
  .product-card { transition: transform 0.3s, box-shadow 0.3s; cursor: pointer; }
  .product-card:hover { transform: scale(1.05); box-shadow: 0 10px 25px rgba(0,0,0,0.15); }
  #cart-sidebar { transition: right 0.3s; }
</style>
</head>
<body class="bg-gray-50 text-gray-800 font-sans relative">

<!-- Navbar -->
<nav id="navbar" class="py-4">
  <div class="max-w-6xl mx-auto px-4 flex justify-between items-center">
    <span class="text-2xl font-bold">Keystom</span>
    <div class="space-x-4 text-gray-700 hidden sm:flex">
      <a href="#products" class="hover:text-gray-900 transition">Products</a>
      <a href="#about" class="hover:text-gray-900 transition">About</a>
      <a href="#privacy" class="hover:text-gray-900 transition">Privacy</a>
      <a href="#terms" class="hover:text-gray-900 transition">Terms</a>
      <a href="#contact" class="hover:text-gray-900 transition">Contact</a>
    </div>
  </div>
</nav>

<!-- Hero -->
<section class="text-center py-20 bg-gradient-to-r from-yellow-300 via-red-300 to-pink-300">
  <h1 class="text-5xl font-bold mb-4 text-white">Keystom</h1>
  <p class="text-xl mb-6 text-white">Drive in style with custom fabric keychains</p>
  <a href="#products" class="bg-white text-black px-6 py-3 rounded-lg font-semibold shadow hover:scale-105 transition">Shop Now</a>
</section>

<!-- Products -->
<section id="products" class="py-20 max-w-6xl mx-auto px-4">
  <h2 class="text-3xl font-bold text-center mb-12">Our Keychains</h2>
  <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-8">

    <!-- PRODUCT 1 -->
    <div class="bg-white rounded-lg p-4 text-center product-card"
         data-name="Toyota Supra MK4"
         data-price="17.99"
         data-image="https://via.placeholder.com/150"
         data-colors='["Red","Blue","Black"]'>
      <img src="https://via.placeholder.com/150" class="mx-auto mb-4 rounded shadow-sm">
      <h3 class="font-bold mb-2">Toyota Supra MK4</h3>
      <p class="text-gray-600 mb-4">17.99$</p>
      <button class="bg-black text-white px-4 py-2 rounded hover:bg-gray-800 transition add-to-cart w-full">Add to Cart</button>
    </div>

    <!-- PRODUCT 2 -->
    <div class="bg-white rounded-lg p-4 text-center product-card"
         data-name="Nissan Skyline R34"
         data-price="17.99"
         data-image="https://via.placeholder.com/150"
         data-colors='["Purple","White","Black"]'>
      <img src="https://via.placeholder.com/150" class="mx-auto mb-4 rounded shadow-sm">
      <h3 class="font-bold mb-2">Nissan Skyline R34</h3>
      <p class="text-gray-600 mb-4">17.99$</p>
      <button class="bg-black text-white px-4 py-2 rounded hover:bg-gray-800 transition add-to-cart w-full">Add to Cart</button>
    </div>

    <!-- PRODUCT 3 -->
    <div class="bg-white rounded-lg p-4 text-center product-card"
         data-name="BMW M4"
         data-price="17.99"
         data-image="https://via.placeholder.com/150"
         data-colors='["Yellow","Black","Green"]'>
      <img src="https://via.placeholder.com/150" class="mx-auto mb-4 rounded shadow-sm">
      <h3 class="font-bold mb-2">BMW M4</h3>
      <p class="text-gray-600 mb-4">17.99$</p>
      <button class="bg-black text-white px-4 py-2 rounded hover:bg-gray-800 transition add-to-cart w-full">Add to Cart</button>
    </div>

    <!-- PRODUCT 4 -->
    <div class="bg-white rounded-lg p-4 text-center product-card"
         data-name="MazdaSpeed3 1st Gen"
         data-price="17.99"
         data-image="https://via.placeholder.com/150"
         data-colors='["Red","Gray","Black"]'>
      <img src="https://via.placeholder.com/150" class="mx-auto mb-4 rounded shadow-sm">
      <h3 class="font-bold mb-2">MazdaSpeed3 1st Gen</h3>
      <p class="text-gray-600 mb-4">17.99$</p>
      <button class="bg-black text-white px-4 py-2 rounded hover:bg-gray-800 transition add-to-cart w-full">Add to Cart</button>
    </div>

  </div>
</section>

<!-- PRODUCT POPUP -->
<div id="product-popup" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
  <div class="bg-white p-6 rounded-lg max-w-md w-full relative">
    <button id="close-popup" class="absolute top-2 right-3 text-2xl">&times;</button>
    <img id="popup-image" class="mx-auto mb-4 rounded shadow-sm w-48">
    <h3 id="popup-name" class="text-2xl font-bold text-center mb-2"></h3>
    <p class="text-center text-lg mb-4">$<span id="popup-price"></span></p>

    <label class="font-semibold">Select Color:</label>
    <select id="popup-color" class="w-full border rounded px-3 py-2 mb-4"></select>

    <button id="popup-add-cart" class="w-full bg-black text-white py-3 rounded hover:bg-gray-800 transition">
      Add to Cart
    </button>
  </div>
</div>

<!-- Floating Cart Button -->
<button id="cart-button" class="fixed bottom-5 right-5 bg-green-600 text-white px-6 py-3 rounded-full shadow-lg hover:bg-green-700 transition z-50">
  Cart (<span id="cart-count">0</span>)
</button>

<!-- Cart Sidebar -->
<div id="cart-sidebar" class="fixed top-0 right-[-100%] h-full w-80 bg-white shadow-xl z-50 flex flex-col">
  <div class="flex justify-between items-center p-4 border-b">
    <h2 class="text-2xl font-bold">Your Cart</h2>
    <button id="close-cart" class="text-gray-500 hover:text-gray-800 text-2xl">✖</button>
  </div>
  <ul id="cart-items" class="flex-1 overflow-y-auto p-4 space-y-2"></ul>
  <div class="p-4 border-t">
    <p class="font-bold mb-4">Total: $<span id="cart-total">0.00</span></p>
    <button id="checkout-button" class="w-full bg-green-600 text-white py-3 rounded hover:bg-green-700 transition">Checkout</button>
  </div>
</div>

<!-- JS -->
<script>
const cart = [];
const cartCount = document.getElementById('cart-count');
const cartItems = document.getElementById('cart-items');
const cartTotal = document.getElementById('cart-total');
const cartButton = document.getElementById('cart-button');
const cartSidebar = document.getElementById('cart-sidebar');
const closeCart = document.getElementById('close-cart');
const checkoutButton = document.getElementById('checkout-button');

// --- PRODUCT POPUP ELEMENTS ---
const popup = document.getElementById("product-popup");
const popupImage = document.getElementById("popup-image");
const popupName = document.getElementById("popup-name");
const popupPrice = document.getElementById("popup-price");
const popupColor = document.getElementById("popup-color");
const popupAddCart = document.getElementById("popup-add-cart");
const closePopup = document.getElementById("close-popup");

let selectedProduct = null;

// Open product popup
document.querySelectorAll(".product-card").forEach(card => {
  card.addEventListener("click", e => {
    if (e.target.classList.contains("add-to-cart")) return;

    selectedProduct = {
      name: card.dataset.name,
      price: parseFloat(card.dataset.price),
      image: card.dataset.image,
      colors: JSON.parse(card.dataset.colors)
    };

    popupImage.src = selectedProduct.image;
    popupName.textContent = selectedProduct.name;
    popupPrice.textContent = selectedProduct.price.toFixed(2);

    popupColor.innerHTML = "";
    selectedProduct.colors.forEach(c => {
      let opt = document.createElement("option");
      opt.value = c;
      opt.textContent = c;
      popupColor.appendChild(opt);
    });

    popup.classList.remove("hidden");
    popup.classList.add("flex");
  });
});

// Close popup
closePopup.addEventListener("click", () => popup.classList.add("hidden"));

// Add to cart from popup
popupAddCart.addEventListener("click", () => {
  cart.push({
    name: selectedProduct.name + " (" + popupColor.value + ")",
    price: selectedProduct.price
  });
  updateCartUI();
  popup.classList.add("hidden");
  cartSidebar.style.right = "0";
});

// Cart UI
function updateCartUI() {
  cartCount.textContent = cart.length;
  cartItems.innerHTML = '';
  let total = 0;

  cart.forEach((item, index) => {
    const li = document.createElement('li');
    li.className = "flex justify-between items-center";
    li.innerHTML = `${item.name} - $${item.price.toFixed(2)} <button class="text-red-500 ml-2" onclick="removeItem(${index})">✖</button>`;
    cartItems.appendChild(li);
    total += item.price;
  });

  cartTotal.textContent = total.toFixed(2);
}

function removeItem(index) {
  cart.splice(index, 1);
  updateCartUI();
}

cartButton.addEventListener('click', () => cartSidebar.style.right = '0');
closeCart.addEventListener('click', () => cartSidebar.style.right = '-100%');

// Stripe
const stripe = Stripe('YOUR_PUBLISHABLE_KEY');

checkoutButton.addEventListener('click', async () => {
  if(cart.length === 0){ alert("Your cart is empty!"); return; }

  const line_items = cart.map(item => ({
    price_data: {
      currency:'usd',
      product_data:{ name:item.name },
      unit_amount: Math.round(item.price * 100)
    },
    quantity: 1
  }));

  const response = await fetch('/create-checkout-session', {
    method:'POST',
    headers:{ 'Content-Type':'application/json' },
    body:JSON.stringify({ line_items })
  });

  const session = await response.json();
  stripe.redirectToCheckout({ sessionId: session.id });
});
</script>

</body>
</html>
